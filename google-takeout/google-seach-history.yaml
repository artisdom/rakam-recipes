strategy: SPECIFIC
collections:
  spotify_save_track:
    columns:
      - _time:
          category: null
          type: TIMESTAMP
      - _user:
          category: null
          type: STRING
      - track_name:
          category: null
          type: STRING
      - album_name:
          category: null
          type: STRING
      - track_url:
          category: null
          type: STRING
      - artist_name:
          category: null
          type: STRING
  lastfm_scrobble:
    columns:
      - _time:
          category: null
          type: TIMESTAMP
      - album_mbid:
  google_search:
    columns:
      - _time:
          category: null
          type: TIMESTAMP
      - _user:
          category: null
          type: LONG
      - search_term:
          category: null
          type: STRING
      - category:
          category: null
          type: STRING
reports:
  - slug: category
    category: null
    name: Google search category
    query: |-
      SELECT "category", count(*) as count FROM collection."google_search" 
      where category is not null and _time between {date[0]} and {date[1]}
      GROUP BY 1 having count(*) > 10 ORDER BY 2 desc
    shared: false
    options:
      chartType: pie
      limit: 1000
      enableStatistics: true
      tableOptions:
        enabled: true
      chartOptions: {}
      variables:
        - multiple: true
          name: date
          options: {}
          defaultValue: last_year
          type: date-range
      columnOptions:
        - displayFormat: null
          tableOptions:
            cellOptions: {}
          chartOptions: {}
        - displayFormat: null
          tableOptions:
            cellOptions: {}
          chartOptions: {}
      segments: []
      measures:
        - 1
      dimensions:
        - 0
    queryOptions: {}
  - slug: google_search_by_year
    category: null
    name: Google search by year
    query: >-
      SELECT date_part('year', _time) as year, count(*) FROM
      collection."google_search" group by 1
    shared: false
    options:
      chartType: line
      limit: 1000
      enableStatistics: true
      tableOptions:
        enabled: true
      chartOptions:
        showLabels: false
      variables: []
      segments: []
      measures:
        - 1
      dimensions:
        - 0
      columnOptions:
        - displayFormat: null
          tableOptions:
            cellOptions: {}
        - displayFormat: null
          tableOptions:
            cellOptions:
              statistics: relative
            formatNumbers: true
    queryOptions: {}
  - slug: lastfm_artist_category
    category: null
    name: Last.fm artist category
    query: |
      SELECT date_part('year', _time) year, artist_tag, count(*) as count
      FROM lastfm_scrobble
      CROSS JOIN UNNEST(artist_tags) AS t (artist_tag)
      group by 1, 2
      having count(*) > 50
    shared: false
    options:
      chartType: line
      limit: 1000
      enableStatistics: true
      tableOptions:
        enabled: true
        enableServerSide: false
      chartOptions:
        singleColumn: true
      variables: []
      columnOptions:
        - null
        - null
        - tableOptions:
            cellOptions: {}
      segments:
        - 1
      measures:
        - 2
      dimensions:
        - 0
    queryOptions: {}
  - slug: lastfm_artists
    category: null
    name: Last.fm artists
    query: >-
      SELECT ('[' || "artist_name" || '](/test)'), count(*) as count FROM
      collection."lastfm_scrobble" 

      where _time between {date[0]} and {date[1]}

      GROUP BY 1 having count(*) > 1 order by 2 desc
    shared: false
    options:
      chartType: scatter
      limit: 1000
      enableStatistics: true
      tableOptions:
        enabled: true
      chartOptions: {}
      variables:
        - multiple: true
          name: date
          options: {}
          defaultValue: last_month
          type: date-range
      columnOptions:
        - displayFormat: hyperlink
          tableOptions:
            cellOptions: {}
          chartOptions: {}
        - displayFormat: null
          tableOptions:
            cellOptions: {}
          chartOptions: {}
      segments: []
      measures:
        - 1
      dimensions:
        - 0
    queryOptions: {}
  - slug: artist_trends
    category: null
    name: Artist trends by date
    query: >-
      SELECT cast(date_trunc('week', _time) as date) week, count(*) as count
      FROM collection."lastfm_scrobble" 

      where _time between {date[0]} and {date[1]} and artist_name = {artist}

      GROUP BY 1 having count(*) > 1 order by 2 desc
    shared: false
    options:
      chartType: scatter
      limit: 1000
      enableStatistics: true
      tableOptions:
        enabled: true
      chartOptions: {}
      variables:
        - multiple: true
          name: date
          options: {}
          defaultValue: last_month
          type: date-range
        - multiple: false
          name: artist
          options:
            displayType: advanced
            type: custom-query
            typeSettings:
              query: >-
                select artist_name from lastfm_scrobble group by 1 having
                count(*) > 40
          type: string
      columnOptions:
        - displayFormat: yyyy-MM-dd
          tableOptions:
            cellOptions: {}
          chartOptions: {}
        - displayFormat: null
          tableOptions:
            cellOptions: {}
          chartOptions: {}
      segments: []
      measures:
        - 1
      dimensions:
        - 0
    queryOptions: {}
  - slug: popular_tracks
    category: null
    name: Popular tracks
    query: |-
      SELECT image, track_name, count(*) FROM collection."lastfm_scrobble" 
      where _time between {date[0]} and {date[1]}
      group by 1, 2 order by 3 desc
    shared: false
    options:
      chartType: null
      limit: 1000
      enableStatistics: true
      tableOptions:
        enabled: true
        rowHeight: 60
      chartOptions: true
      variables:
        - multiple: true
          name: date
          options: {}
          defaultValue: last_two_weeks
          type: date-range
      columnOptions:
        - displayFormat: image
          tableOptions:
            cellOptions: {}
            hide: false
        - displayFormat: null
          tableOptions:
            cellOptions: {}
            hide: false
        - displayFormat: null
          tableOptions:
            cellOptions: {}
            hide: false
      segments: []
      measures:
        - 2
      dimensions:
        - 0
        - 1
    queryOptions: {}
  - slug: artist_playcount
    category: null
    name: Artist playcount
    query: >-
      SELECT cast(date_trunc('week', _time) as date), avg(artist_playcount) FROM
      collection."lastfm_scrobble" 

      where _time between {date[0]} and {date[1]}

      group by 1 order by 2 desc
    shared: false
    options:
      chartType: line
dashboards:
  - name: Personal
    items:
      - id: 581
        name: Google Searches
        directive: report
        options:
          reportSlug: category
          sizeX: 6
          sizeY: 1
          aggregation: null
          values: {}
          row: 0
          col: 0
        refreshInterval: null
        data: null
        lastUpdated: null
